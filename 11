from opentelemetry import trace
from opentelemetry.sdk.resources import Resource
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import (
    SimpleSpanProcessor,
    ConsoleSpanExporter,
)

# 1️⃣ Set up a Tracer Provider with resource info (service name)
resource = Resource(attributes={
    "service.name": "demo-otel-sdk-app"
})

provider = TracerProvider(resource=resource)
trace.set_tracer_provider(provider)

# 2️⃣ Add an exporter (to print spans to console)
exporter = ConsoleSpanExporter()
span_processor = SimpleSpanProcessor(exporter)
provider.add_span_processor(span_processor)

# 3️⃣ Create a tracer
tracer = trace.get_tracer(__name__)

# 4️⃣ Create and end a span manually
with tracer.start_as_current_span("sample-span") as span:
    span.set_attribute("example.key", "value123")
    span.add_event("An event inside the span")
    print("Doing some work...")

print("✅ Trace completed and exported.")