import requests
import json

SPLUNK_API_TOKEN_TARGET = "YOUR_PROD_API_TOKEN"
SPLUNK_API_URL_TARGET = "https://api.<REALM>.signalfx.com/v2/detector"

headers = {
    "Authorization": f"Bearer {SPLUNK_API_TOKEN_TARGET}",
    "Content-Type": "application/json"
}

# Load cleaned detectors JSON exported from non-prod
with open("detectors_with_tag_xxx_clean.json", "r") as f:
    detectors_data = json.load(f)

# Iterate through detectors and create each on prod
for detector in detectors_data.get("results", []):
    response = requests.post(
        SPLUNK_API_URL_TARGET,
        headers=headers,
        json=detector
    )
    if response.status_code in (200, 201):
        print(f"Created detector: {detector.get('name', '<no name>')}")
    else:
        print(f"Failed to create detector {detector.get('name', '<no name>')}: {response.text}")
